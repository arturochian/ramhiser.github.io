<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      John Ramey &middot; Statistics and Machine Learning
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <!-- MathJax -->
  <script type="text/javascript"
          src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>

</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>The personal site of <a href="http://ramhiser.com">John Ramey</a> to discuss statistics, machine learning, and other endeavors.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item active" href="/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About Me</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/blogroll/">Blogroll</a>
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/research/">Publications/Technical Reports</a>
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/software/">Software</a>
        
      
    

  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2015. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">John Ramey</a>
            <small>Statistics and Machine Learning</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/python/scikit-learn/scipy/mac/data-science/2015/01/24/installing-python-data-science-stack-on-yosemite/">
        Installing Python Data Science Stack on Yosemite
      </a>
    </h1>

    <span class="post-date">24 Jan 2015</span>

    <p>I was attempting to install the Python data-science stack within a fresh virtual
environment on my Mac with OS X 10.10.1 (Yosemite) but encountered various
frustrating errors. I logged my steps below that eventually yielded a successful
installation.</p>

<p>My primary goal was actually to install version 0.15.2 of
<a href="http://scikit-learn.org/">scikit-learn</a> via <code>pip install -U scikit-learn</code>, but
I encountered some errors during the <code>scipy</code> installation. The process
successfully added <code>numpy 1.9.1</code> but failed on <code>scipy 0.15.1</code>. I then tried to
install that version of <code>scipy</code> individually but received the following error.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">In file included from /usr/include/dispatch/dispatch.h:51:0,

  from /System/Library/Frameworks/IOKit.framework/Headers/IOKitLib.h:56,

  from /System/Library/Frameworks/CoreGraphics.framework/Headers/CGDisplayConfiguration.h:8,

  from /System/Library/Frameworks/CoreGraphics.framework/Headers/CoreGraphics.h:41,

  from /System/Library/Frameworks/Accelerate.framework/Frameworks/vImage.framework/Headers/vImage_Utilities.h:14,

  from /System/Library/Frameworks/Accelerate.framework/Frameworks/vImage.framework/Headers/vImage.h:200,

  from /System/Library/Frameworks/Accelerate.framework/Headers/Accelerate.h:24,

  from /Users/ramhiser/.virtualenvs/dossier/build/scipy/scipy/_build_utils/src/wrap_accelerate_c.c:1:

  /usr/include/dispatch/object.h:143:15: error: expected identifier or <span class="s1">&#39;(&#39;</span> before <span class="s1">&#39;^&#39;</span> token

   typedef void <span class="o">(</span>^dispatch_block_t<span class="o">)(</span>void<span class="o">)</span><span class="p">;</span>

                 ^

  /usr/include/dispatch/object.h:362:3: error: unknown <span class="nb">type </span>name <span class="s1">&#39;dispatch_block_t&#39;</span>

   dispatch_block_t notification_block<span class="o">)</span><span class="p">;</span></code></pre></div>

<p>After a few Google searches and a bit of trial and error, I followed
instructions in this <a href="http://stackoverflow.com/a/19850962/234233">StackOverflow
post</a> to attempt a fix. As mentioned
below, I still received an error. Here were my initial steps:</p>

<ol>
  <li>
    <p>Download and install XCode Command Line Tools from <a href="https://developer.apple.com">Apple</a></p>
  </li>
  <li>
    <p>Installing <code>scipy</code> still failed at this point</p>
  </li>
  <li>
    <p><code>sudo xcode-select --switch /Applications/Xcode.app/Contents/Developer/</code></p>
  </li>
  <li>
    <p><code>brew update</code></p>
  </li>
  <li>
    <p><code>brew doctor</code></p>
  </li>
  <li>
    <p><code>pip install -U scipy</code> still failed with same error message.</p>
  </li>
  <li>
    <p>A few hints from a random <a href="https://github.com/robotastic/homebrew-hackrf#troubleshooting">README
file</a> suggested
that I do the following:</p>
  </li>
</ol>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">export </span><span class="nv">CC</span><span class="o">=</span>clang
<span class="nb">export </span><span class="nv">CXX</span><span class="o">=</span>clang++
<span class="nb">export </span><span class="nv">LDFLAGS</span><span class="o">=</span><span class="s1">&#39;-L/opt/X11/lib&#39;</span>
<span class="nb">export </span><span class="nv">CFLAGS</span><span class="o">=</span><span class="s1">&#39;-I/opt/X11/include -I/opt/X11/include/freetype2&#39;</span></code></pre></div>

<p>Well, a new error message at this point.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="s2">&quot;_main&quot;</span>, referenced from:

       implicit entry/start <span class="k">for</span> main executable

  ld: symbol<span class="o">(</span>s<span class="o">)</span> not found <span class="k">for</span> architecture x86_64

  collect2: error: ld returned <span class="m">1</span> <span class="nb">exit </span>status</code></pre></div>

<p>Based on <a href="http://stackoverflow.com/a/11798574/234233">a couple</a> <a href="http://forrestbao.blogspot.com/2010/04/compiling-numpy-and-scipy-on-centos.html">more
posts</a>,
I next unset <code>LDFLAGS</code> and <code>CFLAGS</code>. I attempted to install at this point and
again saw the latter error message.</p>

<p>At this point, I was quite frustrated. I closed my terminal
<a href="http://iterm2.com">iTerm2</a> and reopened it. Forgoing the <code>LDFLAGS</code> and <code>CFLAGS</code>
options, I set:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">export </span><span class="nv">CC</span><span class="o">=</span>clang
<span class="nb">export </span><span class="nv">CXX</span><span class="o">=</span>clang++</code></pre></div>

<p>This time I was able to install both <code>scipy</code> and <code>scikit-learn</code> successfully.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/r/python/baseball/rankings/bradley-terry/statistics/2013/08/31/mlb-rankings-using-the-bradley-terry-model/">
        MLB Rankings Using the Bradley-Terry Model
      </a>
    </h1>

    <span class="post-date">31 Aug 2013</span>

    <p>Today, I take my first shots at ranking Major League Baseball (MLB) teams. I see
my efforts at prediction and ranking an ongoing process so that my models
improve, the data I incorporate are more meaningful, and ultimately my
predictions are largely accurate. For the first attempt, let’s rank MLB teams
using the <a href="http://en.wikipedia.org/wiki/Pairwise_comparison#Probabilistic_models">Bradley-Terry (BT) model</a>.</p>

<p>Before we discuss the rankings, we need some data. Let’s scrape <a href="http://espn.go.com/mlb/standings/grid/_/year/2013">ESPN’s MLB Standings Grid</a> for a
win-loss matchups of any two MLB teams for the current season. Perhaps to
simplify the tables and to reduce the sparsity resulting from <a href="http://en.wikipedia.org/wiki/Interleague_play">interleague play</a>, ESPN provides only the
matchup records within a single league – American or National. Accompanying the
matchups, the data include a team’s overall record versus the other league, but
we will ignore this for now. The implication is that we can rank teams only
within the same league.</p>

<h2 id="scraping-espn-with-a-python-script">Scraping ESPN with a Python Script</h2>

<p>In the following Python script, the <a href="http://www.crummy.com/software/BeautifulSoup/">BeautifulSoup library</a> is used to scrape ESPN’s
site for a given year. The script identifies each team in the American League
table, their opponents, and their records against each opponent. The results are
outputted in a CSV file to analyze in R. The code is for the American League
only, but it is straightforward to modify the code to gather the National League
data. Below, I use only the data for 2013 and ignore the previous seasons. In a
future post though, I will incorporate these data.</p>

<p>Here’s the Python code. Feel free to fork it.</p>

<script src="https://gist.github.com/6331163.js"> </script>

<h2 id="bradley-terry-model">Bradley-Terry Model</h2>

<p>The <a href="http://en.wikipedia.org/wiki/Pairwise_comparison#Probabilistic_models">BT model</a> is
a simple approach to modeling pairwise competitions, such as sporting events,
that do not result in ties and is well-suited to the ESPN data above where we
know only the win-loss records between any two teams. (If curious, <a href="http://www.jstor.org/discover/10.2307/2283595">ties can be handled with modifications</a>.)</p>

<p>Suppose that teams <script type="math/tex">i</script> and <script type="math/tex">j</script> play each other, and we wish to know the
probability <script type="math/tex">p_{ij}</script> that team <script type="math/tex">i</script> will beat team <script type="math/tex">j</script>. Then, with the BT
model we define</p>

<script type="math/tex; mode=display">
\text{logit}(p_{ij}) = \lambda_i - \lambda_j,
</script>

<p>where <script type="math/tex">\lambda_i</script> and <script type="math/tex">\lambda_j</script> denote the abilities of teams <script type="math/tex">i</script> and
<script type="math/tex">j</script>, respectively. Besides calculating the probability of one team beating
another, the team abilities provide a natural mechanism for ranking teams. That
is, if <script type="math/tex">\lambda_i > \lambda_j</script>, we say that team <script type="math/tex">i</script> is ranked superior to
team <script type="math/tex">j</script>, providing an ordering on the teams within a league.</p>

<p>Perhaps naively, we assume that all games are independent. This assumption makes
it straightforward to write the likelihood, which is essentially the product of
Bernoulli likelihoods representing each team matchup. To estimate the team
abilities, we use the <a href="http://cran.r-project.org/web/packages/BradleyTerry2/index.html">BradleyTerry2 R package</a>. The
<a href="http://cran.r-project.org/web/packages/BradleyTerry2/vignettes/BradleyTerry.pdf">package vignette</a>
provides an excellent overview of the Bradley-Terry model as well as various
approaches to incorporating covariates (e.g., home-field advantage) and random
effects, some of which I will consider in the future. One thing to note is that
the ability of the first team appearing in the results data frame is used as a
reference and is set to 0.</p>

<p>I have placed all of the R code used for the analysis below within
<strong>bradley-terry.r</strong> in <a href="https://github.com/ramey/baseball-rankings">this GitHub repository</a>. Note that I use the
<a href="http://projecttemplate.net/">ProjectTemplate</a> <a href="http://cran.r-project.org/web/packages/ProjectTemplate/index.html">package</a> to
organize the analysis and to minimize boiler-plate code.</p>

<p>After scraping the matchup records from ESPN, the following R code prettifies
the data and then fits the BT model to both data sets.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Cleans the American League (AL) and National League (NL) data scraped from</span>
<span class="c1"># ESPN&#39;s MLB Grid</span>
AL_cleaned <span class="o">&lt;-</span> clean_ESPN_grid_data<span class="p">(</span>AL.standings<span class="p">,</span> league <span class="o">=</span> <span class="s">&quot;AL&quot;</span><span class="p">)</span>
NL_cleaned <span class="o">&lt;-</span> clean_ESPN_grid_data<span class="p">(</span>NL.standings<span class="p">,</span> league <span class="o">=</span> <span class="s">&quot;NL&quot;</span><span class="p">)</span>

<span class="c1"># Fits the Bradley-Terry models for both leagues</span>
<span class="kp">set.seed</span><span class="p">(</span><span class="m">42</span><span class="p">)</span>
AL_model <span class="o">&lt;-</span> BTm<span class="p">(</span><span class="kp">cbind</span><span class="p">(</span>Wins<span class="p">,</span> Losses<span class="p">),</span> Team<span class="p">,</span> Opponent<span class="p">,</span> <span class="o">~</span>team_<span class="p">,</span> id <span class="o">=</span> <span class="s">&quot;team_&quot;</span><span class="p">,</span> data <span class="o">=</span> AL_cleaned<span class="o">$</span>standings<span class="p">)</span>
NL_model <span class="o">&lt;-</span> BTm<span class="p">(</span><span class="kp">cbind</span><span class="p">(</span>Wins<span class="p">,</span> Losses<span class="p">),</span> Team<span class="p">,</span> Opponent<span class="p">,</span> <span class="o">~</span>team_<span class="p">,</span> id <span class="o">=</span> <span class="s">&quot;team_&quot;</span><span class="p">,</span> data <span class="o">=</span> NL_cleaned<span class="o">$</span>standings<span class="p">)</span>

<span class="c1"># Extracts team abilities for each league</span>
AL_abilities <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>BTabilities<span class="p">(</span>AL_model<span class="p">))</span><span class="o">$</span>ability
<span class="kp">names</span><span class="p">(</span>AL_abilities<span class="p">)</span> <span class="o">&lt;-</span> AL_cleaned<span class="o">$</span>teams

NL_abilities <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>BTabilities<span class="p">(</span>NL_model<span class="p">))</span><span class="o">$</span>ability
<span class="kp">names</span><span class="p">(</span>NL_abilities<span class="p">)</span> <span class="o">&lt;-</span> NL_cleaned<span class="o">$</span>teams</code></pre></div>

<p>Next, we create a heatmap of probabilities winning for each matchup by first
creating a grid of the probabilities. Given that the inverse logit of 0 is 0.5,
the probability that team beats itself is estimated as 0.5. To avoid this
confusing situation, we set these probabilities to 0. The point is that these
events can never happen unless you play for Houston or have A-Rod on your team.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">AL_probs <span class="o">&lt;-</span> <span class="kp">outer</span><span class="p">(</span>AL_abilities<span class="p">,</span> AL_abilities<span class="p">,</span> prob_BT<span class="p">)</span>
<span class="kp">diag</span><span class="p">(</span>AL_probs<span class="p">)</span> <span class="o">&lt;-</span> <span class="m">0</span>
AL_probs <span class="o">&lt;-</span> melt<span class="p">(</span>AL_probs<span class="p">)</span>

NL_probs <span class="o">&lt;-</span> <span class="kp">outer</span><span class="p">(</span>NL_abilities<span class="p">,</span> NL_abilities<span class="p">,</span> prob_BT<span class="p">)</span>
<span class="kp">diag</span><span class="p">(</span>NL_probs<span class="p">)</span> <span class="o">&lt;-</span> <span class="m">0</span>
NL_probs <span class="o">&lt;-</span> melt<span class="p">(</span>NL_probs<span class="p">)</span>

<span class="kp">colnames</span><span class="p">(</span>AL_probs<span class="p">)</span> <span class="o">&lt;-</span> <span class="kp">colnames</span><span class="p">(</span>NL_probs<span class="p">)</span> <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;Team&quot;</span><span class="p">,</span> <span class="s">&quot;Opponent&quot;</span><span class="p">,</span> <span class="s">&quot;Probability&quot;</span><span class="p">)</span></code></pre></div>

<p>Now that the rankings and matchup probabilities have been computed, let’s take a
look at the results for each league.</p>

<h2 id="american-league-results">American League Results</h2>

<p>The BT model provides a natural way of ranking teams based on the team-ability
estimates. Let’s first look at the estimates.</p>

<p><img src="http://i.imgur.com/XgwLvtS.png" alt="plot of chunk AL_team_abilities_barplot" /> </p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">## |     | ability | s.e.  |</span>
<span class="c1">## |-----+---------+-------|</span>
<span class="c1">## | ARI | 0.000   | 0.000 |</span>
<span class="c1">## | ATL | 0.461   | 0.267 |</span>
<span class="c1">## | CHC | -0.419  | 0.264 |</span>
<span class="c1">## | CIN | 0.267   | 0.261 |</span>
<span class="c1">## | COL | 0.015   | 0.250 |</span>
<span class="c1">## | LAD | 0.324   | 0.255 |</span>
<span class="c1">## | MIA | -0.495  | 0.265 |</span>
<span class="c1">## | MIL | -0.126  | 0.260 |</span>
<span class="c1">## | NYM | -0.236  | 0.262 |</span>
<span class="c1">## | PHI | -0.089  | 0.261 |</span>
<span class="c1">## | PIT | 0.268   | 0.262 |</span>
<span class="c1">## | SD  | -0.176  | 0.251 |</span>
<span class="c1">## | SF  | -0.100  | 0.251 |</span>
<span class="c1">## | STL | 0.389   | 0.262 |</span>
<span class="c1">## | WSH | -0.013  | 0.265 |</span></code></pre></div>

<p>(Please excuse the crude tabular output. I’m not a fan of how <a href="http://octopress.org/">Octopress</a> renders tables. Suggestions?)</p>

<p>The plot and the table give two representations of the same information.  In
both cases we can see that the team abilities are standardized so that Baltimore
has an ability of 0. We also see that Tampa Bay is considered the top AL team
with Boston being a <strong>close</strong> second. Notice though that the standard errors
here are large enough that we might question the rankings by team ability. For
now, we will ignore the standard errors, but this uncertainty should be taken
into account for predicting future games.</p>

<p>The Astros stand out as the worse team in the AL. Although the graph seems to
indicate that Houston is by far worse than any other AL team, the ability is not
straightforward to interpret. Rather, using the inverse logit function, we can
compare more directly any two teams by calculating the probability that one team
will beat another.</p>

<p>A quick way to compare any two teams is with a heatmap. Notice how Houston’s
probability of beating another AL team is less than 50%. The best team, Tampa
Bay, has more than a 50% chance of beating any other AL team.</p>

<p><img src="http://i.imgur.com/9IfSUag.png" alt="plot of chunk AL_matchup_heatmaps" /> </p>

<p>While the heatmap is useful for comparing any two teams at a glance, bar graphs
provide a more precise representation of who will win. Here are the
probabilities that the best and worst teams in the AL will beat any other AL
team. A horizontal red threshold is drawn at 50%.</p>

<p><img src="http://i.imgur.com/WAD1Cc3.png" alt="plot of chunk AL_probs_top_team" /> </p>

<p><img src="http://i.imgur.com/JRUd5Bj.png" alt="plot of chunk AL_probs_bottom_team" /> </p>

<p>An important thing to notice here is that Tampa Bay is not unbeatable, according
to the BT model, the Astros have a shot at winning against any other AL team.</p>

<p><img src="http://i.imgur.com/q3CB6tp.png" alt="plot of chunk AL_probs_middle_team" /> </p>

<p>I have also found that a useful gauge is to look at the probability that an
average team will beat any other team. For instance, Cleveland is ranked in the
middle according to the BT model. Notice that half of the teams have greater
than 50% chance to beat them, while the Indians have more than 50% chance of
beating the remaining teams. The Indians have a very good chance of beating the
Astros.</p>

<h2 id="national-league-results">National League Results</h2>

<p>Here, we repeat the same analysis for the National League.</p>

<p><img src="http://i.imgur.com/5BQt4xM.png" alt="plot of chunk NL_team_abilities_barplot" /> </p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">## |     | ability | s.e.  |</span>
<span class="c1">## |-----+---------+-------|</span>
<span class="c1">## | ARI | 0.000   | 0.000 |</span>
<span class="c1">## | ATL | 0.461   | 0.267 |</span>
<span class="c1">## | CHC | -0.419  | 0.264 |</span>
<span class="c1">## | CIN | 0.267   | 0.261 |</span>
<span class="c1">## | COL | 0.015   | 0.250 |</span>
<span class="c1">## | LAD | 0.324   | 0.255 |</span>
<span class="c1">## | MIA | -0.495  | 0.265 |</span>
<span class="c1">## | MIL | -0.126  | 0.260 |</span>
<span class="c1">## | NYM | -0.236  | 0.262 |</span>
<span class="c1">## | PHI | -0.089  | 0.261 |</span>
<span class="c1">## | PIT | 0.268   | 0.262 |</span>
<span class="c1">## | SD  | -0.176  | 0.251 |</span>
<span class="c1">## | SF  | -0.100  | 0.251 |</span>
<span class="c1">## | STL | 0.389   | 0.262 |</span>
<span class="c1">## | WSH | -0.013  | 0.265 |</span></code></pre></div>

<p>For the National League, Arizona is the reference team having an ability of
0. The Braves are ranked as the top team, and the Marlins are the worst team.
At first glance, the differences in National League team abilities between two
consecutively ranked teams are less extreme than the American League. However,
it is unwise to interpret the abilities in this way. As with the American
League, we largely ignore the standard errors, although it is interesting to
note that the top and bottom NL team abilities have more separation between them
when the standard error is taken into account.</p>

<p>As before, let’s look at the matchup probabilities.</p>

<p><img src="http://i.imgur.com/aVpVIDK.png" alt="plot of chunk NL_matchup_heatmaps" /> </p>

<p>From the heatmap we can see that the Braves have at least a 72% chance of
beating the Marlins, according to the BT model. All other winning probabilities
are less than 72%, giving teams like the Marlins, Cubs, and Mets a shot at
winning.</p>

<p>Again, we plot the probabilities for the best and the worst teams along with an
average team.</p>

<p><img src="http://i.imgur.com/sZXVmFL.png" alt="plot of chunk NL_probs_top_team" /> </p>

<div class="highlight"><pre><code class="language-r" data-lang="r">ATL_probs <span class="o">&lt;-</span> <span class="kp">subset</span><span class="p">(</span>NL_probs<span class="p">,</span> Team <span class="o">==</span> <span class="s">&quot;ATL&quot;</span> <span class="o">&amp;</span> Opponent <span class="o">!=</span> <span class="s">&quot;ATL&quot;</span><span class="p">)</span>
prob_ATL_SF <span class="o">&lt;-</span> <span class="kp">subset</span><span class="p">(</span>ATL_probs<span class="p">,</span> Opponent <span class="o">==</span> <span class="s">&quot;SF&quot;</span><span class="p">)</span><span class="o">$</span>Probability
series_probs <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>Wins <span class="o">=</span> <span class="m">0</span><span class="o">:</span><span class="m">3</span><span class="p">,</span> Probability <span class="o">=</span> dbinom<span class="p">(</span><span class="m">0</span><span class="o">:</span><span class="m">3</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> prob_ATL_SF<span class="p">))</span>
<span class="kp">print</span><span class="p">(</span>ascii<span class="p">(</span>series_probs<span class="p">,</span> include.rownames <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span> digits <span class="o">=</span> <span class="m">3</span><span class="p">),</span> type <span class="o">=</span> <span class="s">&quot;org&quot;</span><span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">## | Wins  | Probability |</span>
<span class="c1">## |-------+-------------|</span>
<span class="c1">## | 0.000 | 0.048       |</span>
<span class="c1">## | 1.000 | 0.252       |</span>
<span class="c1">## | 2.000 | 0.442       |</span>
<span class="c1">## | 3.000 | 0.258       |</span></code></pre></div>

<p>I find it very interesting that the probability Atlanta beats any other NL team
is usually around 2/3. This makes sense in a lot of ways. For instance, if
Atlanta has a three-game series with the Giants, odds are good that Atlanta will
win 2 of the 3 games. Moreover, as we can see in the table above, there is less
than a 5% chance that the Giants will sweep Atlanta.</p>

<p><img src="http://i.imgur.com/E24KZ1Z.png" alt="plot of chunk NL_probs_bottom_team" /> </p>

<p>The BT model indicates that the Miami Marlins are the worst team in the National
League. Despite their poor performance this season, except for the Braves and
the Cardinals, the Marlins have a legitimate chance to beat other NL teams. This
is especially the case against the other bottom NL teams, such as the Cubs and
the Mets.</p>

<p><img src="http://i.imgur.com/ikAMFQS.png" alt="plot of chunk NL_probs_middle_team" /> </p>

<h2 id="whats-next">What’s Next?</h2>

<p>The above post ranked the teams within the American and National leagues
separately for the current season, but similar data are also available on ESPN
going back to 2002. With this in mind, obvious extensions are:</p>

<ul>
  <li>
    <p>Rank the leagues together after scraping the <a href="http://en.wikipedia.org/wiki/Interleague_play">interleague play</a> matchups.</p>
  </li>
  <li>
    <p>Examine how ranks change over time.</p>
  </li>
  <li>
    <p>Include previous matchup records as prior information for later seasons.</p>
  </li>
  <li>
    <p>Predict future games. Standard errors should not be ignored here.</p>
  </li>
  <li>
    <p>Add covariates (e.g., home-field advantage) to the BT model.</p>
  </li>
</ul>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/r/statistics/machine%20learning/classification/mixture%20models/2013/07/02/a-brief-look-at-mixture-discriminant-analysis/">
        A Brief Look at Mixture Discriminant Analysis
      </a>
    </h1>

    <span class="post-date">02 Jul 2013</span>

    <p>Lately, I have been working with finite mixture models for my postdoctoral work
on data-driven automated <a href="http://en.wikipedia.org/wiki/Gate_%28cytometry%29">gating</a>.
Given that I had barely scratched the surface with mixture models in the
classroom, I am becoming increasingly comfortable with them. With this in mind,
I wanted to explore their application to classification because there are times
when a single class is clearly made up of multiple subclasses that are not
necessarily adjacent.</p>

<p>As far as I am aware, there are two main approaches (there are lots and lots of
variants!) to applying finite mixture models to classfication:</p>

<ol>
  <li>
    <p>The <a href="http://www.stat.washington.edu/raftery/Research/PDF/fraley2002.pdf">Fraley and Raftery approach</a> via <a href="http://cran.r-project.org/web/packages/mclust/index.html">the mclust R package</a></p>
  </li>
  <li>
    <p>The <a href="http://www.jstor.org/stable/2346171">Hastie and Tibshirani approach</a> via <a href="http://cran.r-project.org/web/packages/mda/index.html">the mda R package</a></p>
  </li>
</ol>

<p>Although the methods are similar, I opted for exploring the latter method. Here
is the general idea. There are <script type="math/tex">K \ge 2</script> classes, and each class is assumed to
be a Gaussian mixuture of subclasses. Hence, the model formulation is generative,
and the posterior probability of class membership is used to classify an
unlabeled observation. Each subclass is assumed to have its own mean vector, but
all subclasses share the same covariance matrix for model parsimony. The model
parameters are estimated via <a href="http://en.wikipedia.org/wiki/Expectation%E2%80%93maximization_algorithm">the EM algorithm</a>.</p>

<p>Because the details of the likelihood in the paper are brief, I realized I was a
bit confused with how to write the likelihood in order to determine how much
each observation contributes to estimating the common covariance matrix in the
M-step of the EM algorithm. Had each subclass had its own covariance matrix, the
likelihood would simply be the product of the individual class likelihoods and
would have been straightforward. The source of my confusion was how to write
the complete data likelihood when the classes share parameters.</p>

<p>I decided to write up a document that explicitly defined the likelihood and
provided the details of the EM algorithm used to estimate the model parameters.
<a href="http://ramhiser.com/research/mixture-discriminant-analysis.html">The document is available here</a>
along with <a href="https://github.com/ramey/tech-reports/tree/master/mixture-discrim-analysis">the LaTeX and R code</a>.
If you are inclined to read the document, please let me know if any notation is
confusing or poorly defined. Note that I did not include the additional topics
on reduced-rank discrimination and shrinkage.</p>

<p>To see how well the mixture discriminant analysis (MDA) model worked, I
constructed a simple toy example consisting of 3 bivariate classes each having 3
subclasses. The subclasses were placed so that within a class, no subclass is
adjacent. The result is that no class is Gaussian. I was interested in seeing
if the MDA classifier could identify the subclasses and also comparing its
decision boundaries with those of <a href="http://en.wikipedia.org/wiki/Linear_discriminant_analysis">linear discriminant analysis (LDA)</a>
and <a href="http://en.wikipedia.org/wiki/Quadratic_classifier#Quadratic_discriminant_analysis">quadratic discriminant analysis (QDA)</a>.
I used the implementation of the LDA and QDA classifiers in <a href="http://cran.r-project.org/web/packages/MASS/index.html">the MASS package</a>.
From the scatterplots and decision boundaries given below,
the LDA and QDA classifiers yielded puzzling decision boundaries as expected.
Contrarily, we can see that the MDA classifier does a good job of identifying
the subclasses. It is important to note that all subclasses in this example have
the same covariance matrix, which caters to the assumption employed in the MDA
classifier. It would be interesting to see how sensitive the classifier is to
deviations from this assumption. Moreover, perhaps a more important investigation
would be to determine how well the MDA classifier performs as the feature
dimension increases relative to the sample size.</p>

<p><img src="http://i.imgur.com/LIQPL0u.png" alt="LDA Decision Boundaries" /></p>

<p><img src="http://i.imgur.com/GeyXCsf.png" alt="QDA Decision Boundaries" /></p>

<p><img src="http://i.imgur.com/lw0iBxe.png" alt="MDA Decision Boundaries" /></p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kn">library</span><span class="p">(</span>MASS<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>mvtnorm<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>mda<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>ggplot2<span class="p">)</span>

<span class="kp">set.seed</span><span class="p">(</span><span class="m">42</span><span class="p">)</span>
n <span class="o">&lt;-</span> <span class="m">500</span>

<span class="c1"># Randomly sample data</span>
x11 <span class="o">&lt;-</span> rmvnorm<span class="p">(</span>n <span class="o">=</span> n<span class="p">,</span> mean <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">-4</span><span class="p">,</span> <span class="m">-4</span><span class="p">))</span>
x12 <span class="o">&lt;-</span> rmvnorm<span class="p">(</span>n <span class="o">=</span> n<span class="p">,</span> mean <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">4</span><span class="p">))</span>
x13 <span class="o">&lt;-</span> rmvnorm<span class="p">(</span>n <span class="o">=</span> n<span class="p">,</span> mean <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="m">-4</span><span class="p">))</span>

x21 <span class="o">&lt;-</span> rmvnorm<span class="p">(</span>n <span class="o">=</span> n<span class="p">,</span> mean <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">-4</span><span class="p">,</span> <span class="m">4</span><span class="p">))</span>
x22 <span class="o">&lt;-</span> rmvnorm<span class="p">(</span>n <span class="o">=</span> n<span class="p">,</span> mean <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="m">4</span><span class="p">))</span>
x23 <span class="o">&lt;-</span> rmvnorm<span class="p">(</span>n <span class="o">=</span> n<span class="p">,</span> mean <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">))</span>

x31 <span class="o">&lt;-</span> rmvnorm<span class="p">(</span>n <span class="o">=</span> n<span class="p">,</span> mean <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">-4</span><span class="p">,</span> <span class="m">0</span><span class="p">))</span>
x32 <span class="o">&lt;-</span> rmvnorm<span class="p">(</span>n <span class="o">=</span> n<span class="p">,</span> mean <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">-4</span><span class="p">))</span>
x33 <span class="o">&lt;-</span> rmvnorm<span class="p">(</span>n <span class="o">=</span> n<span class="p">,</span> mean <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="m">0</span><span class="p">))</span>

x <span class="o">&lt;-</span> <span class="kp">rbind</span><span class="p">(</span>x11<span class="p">,</span> x12<span class="p">,</span> x13<span class="p">,</span> x21<span class="p">,</span> x22<span class="p">,</span> x23<span class="p">,</span> x31<span class="p">,</span> x32<span class="p">,</span> x33<span class="p">)</span>
train_data <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>x<span class="p">,</span> y <span class="o">=</span> <span class="kp">gl</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">3</span> <span class="o">*</span> n<span class="p">))</span>

<span class="c1"># Trains classifiers</span>
lda_out <span class="o">&lt;-</span> lda<span class="p">(</span>y <span class="o">~</span> <span class="m">.</span><span class="p">,</span> data <span class="o">=</span> train_data<span class="p">)</span>
qda_out <span class="o">&lt;-</span> qda<span class="p">(</span>y <span class="o">~</span> <span class="m">.</span><span class="p">,</span> data <span class="o">=</span> train_data<span class="p">)</span>
mda_out <span class="o">&lt;-</span> mda<span class="p">(</span>y <span class="o">~</span> <span class="m">.</span><span class="p">,</span> data <span class="o">=</span> train_data<span class="p">)</span>

<span class="c1"># Generates test data that will be used to generate the decision boundaries via</span>
<span class="c1"># contours</span>
contour_data <span class="o">&lt;-</span> <span class="kp">expand.grid</span><span class="p">(</span>X1 <span class="o">=</span> <span class="kp">seq</span><span class="p">(</span><span class="m">-8</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> length <span class="o">=</span> <span class="m">300</span><span class="p">),</span>
                            X2 <span class="o">=</span> <span class="kp">seq</span><span class="p">(</span><span class="m">-8</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> length <span class="o">=</span> <span class="m">300</span><span class="p">))</span>

<span class="c1"># Classifies the test data</span>
lda_predict <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>contour_data<span class="p">,</span>
                          y <span class="o">=</span> <span class="kp">as.numeric</span><span class="p">(</span>predict<span class="p">(</span>lda_out<span class="p">,</span> contour_data<span class="p">)</span><span class="o">$</span><span class="kp">class</span><span class="p">))</span>
qda_predict <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>contour_data<span class="p">,</span>
                          y <span class="o">=</span> <span class="kp">as.numeric</span><span class="p">(</span>predict<span class="p">(</span>qda_out<span class="p">,</span> contour_data<span class="p">)</span><span class="o">$</span><span class="kp">class</span><span class="p">))</span>
mda_predict <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>contour_data<span class="p">,</span>
                          y <span class="o">=</span> <span class="kp">as.numeric</span><span class="p">(</span>predict<span class="p">(</span>mda_out<span class="p">,</span> contour_data<span class="p">)))</span>

<span class="c1"># Generates plots</span>
p <span class="o">&lt;-</span> ggplot<span class="p">(</span>train_data<span class="p">,</span> aes<span class="p">(</span>x <span class="o">=</span> X1<span class="p">,</span> y <span class="o">=</span> X2<span class="p">,</span> color <span class="o">=</span> y<span class="p">))</span> <span class="o">+</span> geom_point<span class="p">()</span>
p <span class="o">+</span> stat_contour<span class="p">(</span>aes<span class="p">(</span>x <span class="o">=</span> X1<span class="p">,</span> y <span class="o">=</span> X2<span class="p">,</span> z <span class="o">=</span> y<span class="p">),</span> data <span class="o">=</span> lda_predict<span class="p">)</span>
  <span class="o">+</span> ggtitle<span class="p">(</span><span class="s">&quot;LDA Decision Boundaries&quot;</span><span class="p">)</span>
p <span class="o">+</span> stat_contour<span class="p">(</span>aes<span class="p">(</span>x <span class="o">=</span> X1<span class="p">,</span> y <span class="o">=</span> X2<span class="p">,</span> z <span class="o">=</span> y<span class="p">),</span> data <span class="o">=</span> qda_predict<span class="p">)</span>
  <span class="o">+</span> ggtitle<span class="p">(</span><span class="s">&quot;QDA Decision Boundaries&quot;</span><span class="p">)</span>
p <span class="o">+</span> stat_contour<span class="p">(</span>aes<span class="p">(</span>x <span class="o">=</span> X1<span class="p">,</span> y <span class="o">=</span> X2<span class="p">,</span> z <span class="o">=</span> y<span class="p">),</span> data <span class="o">=</span> mda_predict<span class="p">)</span>
  <span class="o">+</span> ggtitle<span class="p">(</span><span class="s">&quot;MDA Decision Boundaries&quot;</span><span class="p">)</span></code></pre></div>


  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/r/machine%20learning/statistics/bioinformatics/microarray/data/2012/12/29/high-dimensional-microarray-data-sets-in-r-for-machine-learning/">
        High-Dimensional Microarray Data Sets in R for Machine Learning
      </a>
    </h1>

    <span class="post-date">29 Dec 2012</span>

    <p>Much of my research in machine learning is aimed at small-sample, high-dimensional bioinformatics data sets. For instance, here is <a href="http://www.tandfonline.com/doi/full/10.1080/00949655.2011.625946">a paper of mine on the topic</a>.</p>

<p>A large number of papers proposing new machine-learning methods that target high-dimensional data use the same two data sets and consider few others. These data sets are the 1) <a href="https://github.com/ramey/datamicroarray/wiki/Alon-%281999%29">Alon colon cancer data set</a>, and the 2) <a href="https://github.com/ramey/datamicroarray/wiki/Golub-%281999%29">Golub leukemia data set</a>. Both of the corresponding papers were published in 1999, which indicates that the methods are not keeping up with the data-collection techology. Furthermore, the Golub data set is not useful as a benchmark data set because it is well-separated so that most methods have nearly perfect classification.</p>

<p>My goal has been to find several alternative data sets and provide them in a convenient location so that I could load and analyze them easily and then incorporate the results into my papers. Initially, I aimed to identify a few more data sets, but after I got going on this effort, I found a lot more. What started as a small project turned into something that has saved me a lot of time. I have created the <a href="https://github.com/ramey/datamicroarray">datamicroarray package available from my GitHub account</a>. For each data set included in the package, I have provided a script to download, clean, and save the data set as a named list. See the <a href="https://github.com/ramey/datamicroarray/blob/master/README.md">README file</a> for more details about how the data are stored.</p>

<p>Currently, the package consists of 20 small-sample, high-dimensional data sets to assess machine learning algorithms and models. I have also included a <a href="https://github.com/ramey/datamicroarray/wiki">wiki on the package’s GitHub repository</a> that describes each data set and provides additional information, including a link to the original papers.</p>

<p>The biggest drawback at the moment is the file size of the R package because I store an RData file for each data set. I am investigating alternative approaches to download the data dynamically and am open to suggestions. Also note that the data descriptions are incomplete, so assistance is appreciated.</p>

<p>Feel free to use any of the data sets. As a disclaimer, you should ensure that the data are processed correctly before analyzing and incorporating the results into your own work.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/kaggle/python/requests.py/2012/11/23/how-to-download-kaggle-data-with-python-and-requests-dot-py/">
        How to Download Kaggle Data with Python and requests.py
      </a>
    </h1>

    <span class="post-date">23 Nov 2012</span>

    <p>Recently I started playing with <a href="http://kaggle.com">Kaggle</a>. I quickly became frustrated that in order to download their data I had to use their website. I prefer instead the option to download the data programmatically. After some Googling, <a href="http://www.kaggle.com/c/ClaimPredictionChallenge/forums/t/772/downloading-the-data-from-kaggle-to-remote-linux-instance">the best recommendation I found</a> was to use <a href="http://en.wikipedia.org/wiki/Lynx_(web_browser)">lynx</a>. <a href="http://twitter.com/amcclosky">My friend Anthony</a> recommended that alternatively I should write a Python script.</p>

<p>Although Python is not my primary language, I was intrigued by how simple it was to write the script using <a href="http://docs.python-requests.org/">requests.py</a>. In this example, I download the training data set from <a href="http://www.kaggle.com/c/digit-recognizer/data">Kaggle’s Digit Recognizer competition</a>.</p>

<p>The idea is simple:</p>

<ol>
  <li>Attempt to download a file from Kaggle but get blocked because you are not logged in.</li>
  <li>Login with <a href="http://docs.python-requests.org/">requests.py</a>.</li>
  <li>Download the data.</li>
</ol>

<p>Here’s the code:</p>

<script src="https://gist.github.com/4121260.js"> </script>

<p>Simply change <code>my_username</code> and <code>my_password</code> to your Kaggle login info. Feel free to optimize the chunk size to your liking.</p>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page2">Older</a>
  
  
    <span class="pagination-item newer">Newer</span>
  
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
